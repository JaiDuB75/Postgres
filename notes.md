# Postgres

## Creating and Deleting Databases

Installing and configuring PostgreSQL can be tricky on some operating systems. So rather than install a database server on your computer, during this program, you will use a free database hosted on the internet.

### Hosted Databases

A hosted database, sometimes called a managed database, is a cloud-computing service in which the end user pays a cloud service provider for access to a database. Unlike a local database, you don't have to set up or maintain a hosted database on your own; rather, it's the provider's responsibility to oversee the database's infrastructure.

### ElepantSQL

Create an account for ElephantSQL

### Creating a database

Follow the Create New Instance Button

**Note:** When selecting the region, select the region to closest to you to avoid latency. 

### Deleting a Database

Click Edit to reach the edit instance screeen, at the bottom of the screen is there is a section to delete databases. 


## Installing DBeaver

The easiest way to manage, view, and update a database hosted on the internet is to install a graphical user interface client.

### DBeaver

DBeaver is a free multiplatform database tool for developers, SQL programmers, database administrators, and analysts. It essentially supports any database.

### Install DBeaver

[DBeaver Download Page](https://dbeaver.io/download/)

Follow the instruction to download

### Executing SQL scripts

Structured Query Language (SQL) is the language used to perform operations on a database.

DBeaver comes with an SQL editor that provides syntax highlighting and intelligent statement completion. To open the editor, first select the development connection in the database navigator, then select the SQL Editor icon in the toolbar.


The script below creats a table with three columns user_id, username, role. 

```sql
CREATE TABLE users (
  user_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  user_name varchar(50) NOT NULL UNIQUE,
  role varchar DEFAULT 'user'
);
```

## Database Architecture

A database is defined as an organized collection of data, generally stored and accessed electronically from a computer system.

### Storing Data

Example Database:

| Name | product | Qty | Address |
|------|---------|-----|---------|
| John | Toy A | 1 | 123 Street |
| Mary | Toy B | 2 | 456 Ave | 

### Tables 

A table is a collection of related data held in a table format within a database. Like a spreadsheet, a table consists of columns and rows.

Each row, which represents a complete record of the specific data, is typically identified by one or more values called the primary key.

A primary key is a special table column, or combination of columns, that uniquely identifies each table record. No two rows in a table can have the same primary key.

### Fields

Every table is made up of a fixed set of fields. A field's data type is the most important property because it determines what kind of data the field can store.

A field's data type also determines other important field qualities, such as the following:
- Which formats can be used with the field
- The maximum size of a field value

### When to use which data type

Example Data Types: 

|Data Types        |       Use to Store       | 
|:-----------------|:-------------------------|
|`bool` |Only logical boolean values: True or False|
|`char` |Fixed-length character data where the number of characters is always the same. This could be used to store information such as state code, zip code, or phone number. |
| `varchar` | Variable-length character data, up to around 1 GB max. This could be used to store information such as name, address, or city. |
| `date` | Calendar date (year, month, day) without time (for example, 2020-09-09) |
| `int` | Integers from -2,147,483,648 to +2,147,483,647 |
| `numeric` | Exact numeric values |
| `smallint` | Integer from -32,768 to +32,767 |  
| `serial` | Auto-incrementing integer from 1 to 2,147,483,647. This could be used to store information such as a primary key for a table. |
| `text` | Variable-length characters of any length |
| `timestamp` | Time of day (no date) |
| `uuid` | Universally unique identifier (for example, 28e3d683-e619-46c8-b444-a0f45817db2d) | 

## Creating and Viewing tables 

A PostgreSQL database is made up of several components, of which the table is most significant. The database table is where all of the data in a database is stored. And without tables, there wouldn't be much use for a database. At a minimum, a PostgreSQL database consists of one or more tables.

### Structured Query Language (SQL)

SQL uses certain commands, such as `CREATE`, `DROP`, and `INSERT`, to carry out various tasks.

SQL commands fall into four categories:
- Data Definition Language (DDL)
- Data Query Language (DQL)
- Data Manipulation Language (DML)
- Data Control Language (DCL)

### Data Definition Language 

DDL is a subset of SQL commands that is used to define the tables in the database. It is used to create and modify any object in the database. 

Most Command DDL Commands: 

- `Create`: is used to add new tables to the database.
- `Alter`: is used to alter the structure of the database.
- `Truncate`: is used to remove all records from a table, including removing all storage space allocated for the records.
- `Drop`: is used to delete tables from the database.

### Create Table Statement

The SQL `CREATE` TABLE command is used to create a new table.

Syntax below: 

```sql
CREATE TABLE table_name (
   column_name data_type  column_constraint [ , ]
);
```

The line `column_name data_type column_constraint [ , ]` is called a column definition, and there must be at least one column definition in the table. A column definition describes a column in a table. 

```sql
CREATE TABLE users (
  user_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  user_name varchar(50) NOT NULL UNIQUE,
  role varchar DEFAULT 'user'
);
```

The sql code above creates a table called users with columns named user_id, user_name, and role. user_id is an integer and is the primary key for the table. uer_name is set to a varchar with a size of 50. role is set as a varchar also with no limit. 

### Listing Tables

At times you will want to get information about existing PostgreSQL tables. PostgreSQL provides an information_schema schema that can return information about all of the objects in the database, including tables.

### Describing a Table

The `sql` below is the syntax for getting information from the database

```sql
SELECT
	table_name
FROM
	information_schema.tables
WHERE
	table_schema = 'public'
	AND table_type = 'BASE TABLE'
ORDER BY
	table_name;
```

### Alter Table statement

Sometimes, it's necessary to make changes to a table after it has been created. Especially when the database already contains data, deleting and recreating the table may not be possible.

Use the DDL ALTER TABLE statement to change the structure of a table. There are many ways that a table can be altered, and the full documentation for the ALTER TABLE statement lists all the possibilities.

Alter Table Syntax: 

Adds Column
```sql
ALTER TABLE <table name> ADD COLUMN IF NOT EXISTS <column definition>;
```

Removes Column
```sql
ALTER TABLE <table name> DROP IF EXISTS <column name>;
```

### Drop Table Statement



```sql
DROP TABLE IF EXISTS users;
```

## Inserting Data

Table that will be used for this section: 

```sql
CREATE TABLE IF NOT EXISTS articles (
  article_id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
  title varchar(255) NOT NULL UNIQUE,
  abstract TEXT NOT NULL,
  body varchar,
  author TEXT NOT NULL,
  created_date DATE NOT NULL DEFAULT CURRENT_DATE
);
```

### The `Insert Into` statement

Insert into syntax:

```sql
INSERT INTO <table name>
  (<column list>)
  VALUES (<value list>);
```

The column list is a comma-separated list of the column names for which you are providing a value. 

Insert into articles:

```sql
INSERT INTO articles
  (title, abstract, author)
  VALUES (
    'Five uses for paper that you never imagined',
    'List five surprising uses for paper that you would not think of on your own',
    'Dwight Schrute'
  );
```

### Inserting Multiple Records

Inserting Multiple Records Syntax: 

```sql
INSERT
	INTO
	articles (title, abstract, author)
VALUES
	(
	  'The year of PostgreSQL is every year',
	  'PostgreSQL development began during the Reagan administration — in 1986!',
	  'Gerik Haslegrave'
	),
	(
	  'A Getting Started PostgreSQL Tutorial',
	  'PostgreSQL is a free open source database system that uses and extends the SQL language',
	  'Calv Baudrey'
	),
	(
	  'Experimenting with PostgreSQL in a Container',
	  'When I heard I needed a PostgreSQL database, I immediately thought container.',
	  'Gracie Brann'
	);
```

## Querying Data 

One of the most important aspects of using a database is the practice of retrieving data, whether it's on an ad hoc basis or part of a process that's been coded into an application. There are several ways to retrieve information from a database, but one of the most commonly used methods is submitting queries.

A query is any command used to retrieve data from a table. In SQL, queries are almost always made using the SELECT statement.

### Querying Data

Syntax for retrieving data:

```sql
SELECT <column list>
FROM <table name>;
```

You can select the titles and abstracts of all articles using the following script:

```sql
SELECT title, abstract
FROM articles;
```

### The Where Clause

Sometimes, you do not want all of the data in the table. To restrict the rows that are returned by a SELECT statement, use the WHERE clause.

```sql
SELECT <column list>
FROM <table name>
WHERE <conditions>;
```

Execute the following SQL to select the title column from the articles table, but only where the author column has the value Dwight Schrute:

```sql
SELECT title
FROM articles
WHERE author='Dwight Schrute';
```

### Searching for null 

The key concept for understanding how null values behave in boolean expressions is that NULL is neither TRUE nor FALSE.

Execute the following SQL to find all articles where the body field is NULL:

```sql
SELECT title
FROM articles
WHERE body IS NULL;
```

In addition, you can use IS DISTINCT FROM. This works like an ordinary inequality operator <>, except that it always returns TRUE or FALSE, even when using NULL.

Execute the following SQL to find all articles with a null body value:

```sql
SELECT *
FROM articles
WHERE body IS NOT DISTINCT FROM NULL;
```

Syntax for finding the number of entries: 

```sql
SELECT count(DISTINCT aisle)
FROM products;
```

```sql
SELECT product_name, price
FROM products
WHERE department = 'beverages'
AND aisle = 'tea'
AND price < 15
AND price > 10
AND product_name LIKE '%Raspberry%';
```

## Updating and Deleting Data

Using the employees.sql script for this section: 

### Udating Data

Once data has been inserted into rows within the database, those rows can have one or more of their column values modified through use of the UPDATE statement. Column values may be updated either with constants, identifiers to other datasets, or expressions.

```sql
UPDATE table_name
SET column_name_1 = <value_1>,
    column_name_n = <value_n>;
```

The following SQL updates the country: 

```sql
UPDATE employees
SET country = 'USA';
```

### `Default` 

Using the keyword `DEFAULT` in place of a specific value will set the value to the default value for that particular column in the table. If no default value has been set for the column, the column will be set to NULL.

### `Update` with the `Where` clause

Sometimes you won't want to update every row in the table. To restrict the rows that are updated by a UPDATE statement, add the WHERE clause.

Syntax for updating using the where clause

```sql
UPDATE table_name
SET column_name_1 = <value_1>,
    column_name_n = <value_n>
WHERE <conditions>;
```

SQl below updates employee to changes reports to: 

```sql
UPDATE employees
SET reports_to = 'Fibber McGee'
WHERE reports_to = 'Willie Lyons';
```

### Set multiple column values

```sql
UPDATE employees
SET job_title = 'Chemical Engineer II', city = 'Lawrenceville'
WHERE job_title = 'Chemical Engineer' AND city = 'Trenton';
```

### Deleting Data

When managing data in a database, it may be necessary to delete some rows from a table. In this case, the `DELETE` statement can be used to remove some of the existing records from the table without deleting the table itself.

### `Delete` Statement

The `DELETE` statement doesn't require a `WHERE` clause. However, you almost never want to delete every row in the table, so it's best to get into the habit of always including a `WHERE` clause in a `DELETE` statement to restrict the rows that are deleted.

Delete Statement syntax:

```sql
DELETE FROM <table_name>
WHERE <conditions>
```

### `Truncate` Statement

The `DELETE` statement is most useful when you want to clear only some of the data from a table.

`TRUNCATE`, on the other hand, is useful for clearing all the data at once.

Using a `TRUNCATE` statement is faster than using `DELETE`. This is because `TRUNCATE` removes all rows in the table without scanning every row, unlike the `DELETE` statement.

Truncate Syntax: 

```sql
TRUNCATE TABLE <table_name>;
```

```sql
TRUNCATE TABLE products;
```

### Truncate Multiple Tables

```sql
TRUNCATE TABLE <table_name_1>, <table_name_2>, …;
```

```sql
TRUNCATE TABLE articles, employees;
```